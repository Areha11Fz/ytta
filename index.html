<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Dashboard | Horizontal Scroll</title>

    <!-- Tailwind CSS JIT CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: {
                            850: '#1f2937',
                            950: '#0d1117',
                        },
                    }
                }
            }
        }
    </script>

    <!-- DataTables Tailwind CSS -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/1.13.6/css/dataTables.tailwindcss.min.css" />

    <style>
        /* Custom scrollbar for a better dark theme experience on WebKit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            /* Width of vertical scrollbar */
            height: 8px;
            /* Height of horizontal scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
            /* gray-850, the card background */
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            /* gray-600 */
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
            /* gray-500 */
        }
    </style>

</head>

<body class="bg-gray-950 text-gray-200 antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">YTTA Voucher Dashboard</h1>
            <p class="text-gray-400 mt-2">Buat Yang Tau Tau Aja üòÅ</p>
        </div>

        <div class="bg-gray-850 shadow-lg rounded-lg p-4 sm:p-6">
            <!-- The 'nowrap' class is important for horizontal scrolling -->
            <table id="vouchersTable" class="display nowrap" style="width:100%">
                <!-- Thead will be generated by JavaScript -->
                <thead></thead>
                <!-- Tbody will be populated by DataTables -->
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <!-- DataTables Core & Tailwind Integration JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.tailwindcss.min.js"></script>

    <script>
        $(document).ready(function () {

            // Helper functions (snakeToTitleCase, formatTimestamp, formatCurrency) remain the same
            function snakeToTitleCase(str) {
                if (!str) return '';
                return str.split('_')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
            }

            function formatTimestamp(timestamp) {
                if (!timestamp) return 'N/A';
                const date = new Date(timestamp * 1000);
                return date.toLocaleDateString('en-GB', {
                    day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
                });
            }

            function formatCurrency(num) {
                if (num === undefined || num === null || num === 0) return 'N/A';
                return 'Rp ' + (num / 100000).toLocaleString('id-ID');
            }

            // --- DYNAMIC TABLE INITIALIZATION ---
            $.ajax({
                url: "cleaned_vouchers.json",
                dataType: "json",
                success: function (json) {

                    let allVouchers = [];
                    for (const key in json) {
                        if (json.hasOwnProperty(key)) {
                            allVouchers = allVouchers.concat(json[key]);
                        }
                    }

                    if (allVouchers.length === 0) {
                        $('#vouchersTable').html('<thead><tr><th>No Data Available</th></tr></thead>');
                        return;
                    }

                    const headers = Object.keys(allVouchers[0]);
                    let headerHtml = '<tr>';
                    const dtColumns = headers.map(key => {
                        headerHtml += `<th class="text-left p-3">${snakeToTitleCase(key)}</th>`;

                        const columnDef = { data: key, className: 'p-3' };

                        switch (key) {
                            case 'link':
                                columnDef.render = (data) => `<a href="${data}" target="_blank" class="text-indigo-400 hover:text-indigo-300 font-semibold">Claim Voucher</a>`;
                                columnDef.orderable = false;
                                break;
                            case 'min_spend':
                            case 'cap':
                                columnDef.render = formatCurrency;
                                break;
                            case 'percentage':
                                columnDef.render = (data) => data ? `${data}%` : 'N/A';
                                break;
                            case 'claim_start_time':
                            case 'claim_end_time':
                            case 'start_time':
                            case 'end_time':
                                columnDef.render = formatTimestamp;
                                break;
                            case 'has_expired':
                                columnDef.className += ' text-center';
                                columnDef.render = (data) => data
                                    ? '<span class="px-2 py-1 text-xs font-semibold text-red-100 bg-red-600 rounded-full">Yes</span>'
                                    : '<span class="px-2 py-1 text-xs font-semibold text-green-100 bg-green-600 rounded-full">No</span>';
                                break;
                        }
                        return columnDef;
                    });
                    headerHtml += '</tr>';
                    $('#vouchersTable thead').html(headerHtml);

                    $('#vouchersTable').DataTable({
                        data: allVouchers,
                        columns: dtColumns,
                        renderer: 'tailwindcss',
                        // CRITICAL: This enables the horizontal scrollbar
                        scrollX: true,
                        order: [[headers.indexOf('end_time'), "asc"]]
                    });
                },
                error: function () {
                    $('#vouchersTable').html('<thead><tr><th>Error loading voucher data</th></tr></thead>');
                }
            });
        });
    </script>

</body>

</html>